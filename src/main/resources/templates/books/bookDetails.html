<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@1,300&family=PT+Sans&display=swap"
          rel="stylesheet">
    <link rel="stylesheet" href="/scss/carousel.css">
    <link rel="stylesheet" href="/css/general.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/bookDetails.css">
    <script src="/js/removeAddBook.js"></script>
</head>
<body>
<div th:insert="~{header :: user}"></div>
<div th:if="${book != null}">
    <div class="container">
        <div class="row">
            <div class="col-6 col-md-4">
                <img style="float:left;margin-right:2em;padding-bottom:1em" src="/images/book-details.png"/>

                <th:block th:with="selection=${#authentication.principal.books.?[name == '__${book.name}__']}">
                    <th:block th:if="${selection.size() > 0}">
                        <div style="padding-top:1em">
                            <form th:action="@{'/books/remove/' + ${book.id}}">
                                <input class="button button-remove orange filters-button" type="submit"
                                       value="Remove book from shelf">
                            </form>
                        </div>
                    </th:block>
                    <th:block th:if="${selection.size() == 0}">
                        <div style="padding-top:1em">
                            <form th:action="@{'/books/add/' + ${book.id}}">
                                <input class="button button-put green filters-button" type="submit"
                                       value="Add book to shelf">
                            </form>
                        </div>
                    </th:block>
                </th:block>
            </div>
            <div class="col-12 col-md-8">
                <h1><span th:text="${book.name}"></span></h1>
                <h3><span th:text="${book.author}"></span></h3>
                <h3>Publish date: <span th:text="${book.year}"></span></h3>
                <h3>Edition: <span th:text="${book.edition}"></span></h3>
                <h3><span th:text="${book.image}"></span></h3>
                <h3 style="margin-top:2em">Description</h3>
                <p th:text="${book.description}"></p>
            </div>
        </div>
    </div>
    <div class="container">

        <div th:if="${book.reviews != null && !#lists.isEmpty(book.reviews)}">

            <div class="row">
                <div class="col-6 col-md-4">
                    <h1>Reviews</h1>
                </div>
                <div class="col-6 col-md-8">
                    <h1 class="pull-right">
                        Overall rating:
                        <span th:classappend="${overallRating > 7} ? good : (${overallRating > 4} ? normal : bad)">
                        <span th:text="${overallRating}"></span>/10
                    </span>
                    </h1>
                </div>
            </div>

            <th:block th:each="review : ${book.reviews}">
                <div style="margin-top:3em" class="row">
                    <div class="col-6 col-md-4">
                        <img style="float:left;margin-right:2em;" src="/images/profile-pic-reviews.png"/>
                    </div>
                    <div class="col-6 col-md-8"
                         th:classappend="${review.rating > 7} ? review-good : (${review.rating > 4} ? review-normal : review-bad)">
                        <h4 class="pull-right">
                            Date: <span th:text="${#dates.format(review.reviewDate, 'dd-MM-yyyy HH:mm')}"></span>
                        </h4>

                        <h2 th:text="${review.title}"></h2>

                        <a th:href="@{'/profiles/' + ${review.reviewer.id}}">
                            <h4 style="margin-bottom:2em">

                                By <span th:text="${review.reviewer.username}"></span>, mail: <span
                                    th:text="${review.reviewer.email}"></span>
                            </h4>
                        </a>

                        <h4 th:text="${review.description}"></h4>

                        <h3>Rating: <span th:text="${review.rating}"></span></h3>
                    </div>
                </div>
            </th:block>
        </div>


        <th:block th:with="selection=${book.reviews.?[reviewer.email == '__${#authentication.principal.email}__']}">
            <th:block th:if="${selection.size() == 0}">
                <div>
                    <h1 style="text-align:center">Write your own review:</h1>
                </div>
                <form th:action="@{'/reviews?book=' + ${book.id} + '&reviewer=' + ${#authentication.principal.id}}"
                      th:object="${reviewForm}" method="post">
                    <div class="form-group">
                        <h2>Review title</h2>
                        <input required type="text" id="reviewTitle" th:field="*{title}"/>
                    </div>

                    <div class="form-group">
                        <h2>Review text</h2>
                        <textarea required class="form-control"
                                  id="reviewText"
                                  rows="5"
                                  th:field="*{description}"
                                  placeholder="Write what you like/dislike most of all about this book">
                </textarea>
                    </div>

                    <div class="form-group">
                        <h2>Final score</h2>
                        <input required type="text" id="reviewTotal" th:field="*{rating}"/>
                    </div>

                    <div class="form-group">
                        <h2>Do you recommend this books to other users?</h2>
                        <input type="checkbox" id="recommend" th:field="*{recommend}"/>
                    </div>
                    <input type="submit" value="Submit"/> <input type="reset" value="Reset"/>
                </form>
            </th:block>
        </th:block>


    </div>
</div>
<div th:insert="~{footer :: user}"></div>
</body>
</html>