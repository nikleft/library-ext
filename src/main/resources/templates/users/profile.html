<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@1,300&family=PT+Sans&display=swap"
          rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="/scss/carousel.css">
    <link rel="stylesheet" href="/css/general.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/footer.css">
</head>
<body>
<div th:insert="~{header :: user}"></div>

<div class="container">
    <div class="col-md-12">
        <div class="col-md-4">
            <div class="portlet light profile-sidebar-portlet bordered">
                <div class="profile-userpic">
                    <img src="https://bootdey.com/img/Content/avatar/avatar6.png" class="img-responsive" alt=""></div>
                <div class="profile-usertitle">
                    <div style="padding-bottom:1em" class="profile-usertitle-name"
                         th:text="@{${user.name} + ' ' + ${user.surname}}"></div>
                    <div class="profile-usertitle-job">
                        Profile type: <span th:text="${user.roles[0].name}"></span>
                    </div>
                    <div style="padding-bottom:1em" class="profile-usertitle-job">
                        Registration date: <span th:text="${user.registrationDate}"></span>
                    </div>

                    <th:block
                            th:with="selection=${#authentication.principal.friends.?[username == '__${user.username}__']}">
                        <th:block th:if="${selection.size() > 0}">
                            <form th:action="@{'/profiles/removeFriend/' + ${user.id}}" style="padding-bottom:2em">
                                <button class="button">Remove from friend list</button>
                            </form>
                        </th:block>
                        <th:block
                                th:if="${#authentication.principal.username != user.username && selection.size() == 0}">
                            <form th:action="@{'/profiles/addFriend/' + ${user.id}}" style="padding-bottom:2em">
                                <button class="button">Add friend to list</button>
                            </form>
                        </th:block>
                    </th:block>


                </div>
            </div>
        </div>
        <div class="col-md-8">
            <div class="portlet light bordered">
                <div class="portlet-title tabbable-line">
                    <div class="caption caption-md">
                        <i class="icon-globe theme-font hide"></i>
                        <span class="caption-subject font-blue-madison bold uppercase">Profile information</span>
                    </div>
                </div>
                <div class="portlet-body">
                    <div>

                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs" role="tablist">
                            <li role="presentation" class="active"><a href="#profile" aria-controls="profile" role="tab"
                                                                      data-toggle="tab">Profile</a></li>
                            <li role="presentation"><a href="#mybooks" aria-controls="mybooks" role="tab"
                                                       data-toggle="tab">Book shelf</a></li>
                            <li role="presentation"><a href="#myreviews" aria-controls="myreviews" role="tab"
                                                       data-toggle="tab">Reviews</a></li>
                            <li role="presentation"><a href="#friends" aria-controls="friends" role="tab"
                                                       data-toggle="tab">Friends</a></li>
                            <th:block th:if="${#authentication.getPrincipal().getUsername() == user.username}">
                                <li role="presentation"><a href="#home" aria-controls="home" role="tab"
                                                           data-toggle="tab">Update profile</a></li>
                            </th:block>
                        </ul>

                        <!-- Tab panes -->
                        <div style="padding-top:1em" class="tab-content">
                            <div role="tabpanel" class="tab-pane active" id="profile">
                                <div class="row">
                                    <h3 class="black" style="padding-left:1em">Address: <span
                                            th:text="${user.address}"></span></h3>
                                    <h3 class="black" style="padding-left:1em">Email: <span
                                            th:text="${user.email}"></span></h3>
                                    <h3 class="black" style="padding-left:1em">Phone: <span
                                            th:text="${user.phone}"></span></h3>
                                </div>
                            </div>

                            <div role="tabpanel" class="tab-pane" id="mybooks">
                                <th:block th:each="orderbook : ${user.books}">
                                    <a th:href="@{'/books/' + ${orderbook.id}}">
                                        <div class="row">
                                            <img style="float:left;margin-right:2em;"
                                                 src="/images/book-open.png"/>
                                            <h2 class="black">Book name: <span th:text="${orderbook.name}"></span>
                                            </h2>
                                            <h3 class="black">Author: <span th:text="${orderbook.author}"></span></h3>
                                        </div>
                                    </a>
                                </th:block>
                            </div>

                            <div role="tabpanel" class="tab-pane" id="myreviews">
                                <th:block th:each="review : ${user.reviews}">
                                    <a th:href="@{'/books/' + ${review.book.id}}">
                                        <div class="row">
                                            <img style="float:left;margin-right:2em;"
                                                 src="/images/profile-review-book.png"/>
                                            <h2 class="black">Book name: <span th:text="${review.book.name}"></span>
                                            </h2>
                                            <h3 class="black">Overall: <span th:text="${review.rating}"></span></h3>
                                        </div>
                                    </a>
                                </th:block>
                            </div>

                            <div role="tabpanel" class="tab-pane" id="friends">
                                <th:block th:each="friend : ${user.friends}">
                                    <a th:href="@{'/profiles/' + ${friend.id}}">
                                        <div class="row">
                                            <img style="float:left;margin-right:2em;" src="/images/friend-pic.png"/>
                                            <h2 class="black"
                                                th:text="@{${friend.name} + ' ' + ${friend.surname}}"></h2>
                                            <h4 class="black" th:text="${friend.email}"></h4>
                                        </div>
                                    </a>
                                </th:block>
                            </div>

                            <th:block th:if="${#authentication.getPrincipal().getUsername() == user.username}">
                                <div role="tabpanel" class="tab-pane" id="home">
                                    <form th:action="@{'/profiles/' + ${#authentication.principal.id}}"
                                          th:object="${changeProfileForm}" method="post">
                                        <form>
                                            <div class="form-group">
                                                <h3 style="color:black" for="inputName">Name</h3>
                                                <input required type="text" class="form-control" id="inputName"
                                                       th:value="${changeProfileForm.name}" th:field="*{name}">
                                            </div>
                                            <div class="form-group">
                                                <h3 style="color:black" for="inputLastName">Last Name</h3>
                                                <input required type="text" class="form-control" id="inputLastName"
                                                       th:value="${changeProfileForm.surname}" th:field="*{surname}">
                                            </div>
                                            <div class="form-group">
                                                <h3 style="color:black" for="exampleInputEmail1">Email address</h3>
                                                <input required type="email" class="form-control"
                                                       id="exampleInputEmail1"
                                                       th:value="${changeProfileForm.email}" th:field="*{email}">
                                            </div>
                                            <div class="form-group">
                                                <h3 style="color:black" for="exampleInputAddress1">Address</h3>
                                                <input required type="text" class="form-control"
                                                       id="exampleInputAddress1"
                                                       th:value="${changeProfileForm.address}" th:field="*{address}">
                                            </div>
                                            <div class="form-group">
                                                <h3 style="color:black" for="exampleInputPhone1">Phone</h3>
                                                <input required type="text" class="form-control" id="exampleInputPhone1"
                                                       th:value="${changeProfileForm.phone}" th:field="*{phone}">
                                            </div>
                                            <h3 style="color:black">Choose your favourite genres:</h3>
                                            <th:block th:each="genre, iter : ${genres}">
                                                <div class="form-check">
                                                    <label style="color:black" th:text="${genre.genre.type}"></label>
                                                    <input type="checkbox" name="favouriteGenres"
                                                           th:value="${genre.genre}" th:field="*{favouriteGenres}">
                                                </div>
                                            </th:block>
                                            <button type="submit" class="btn btn-default">Submit</button>
                                        </form>
                                    </form>
                                </div>
                            </th:block>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:insert="~{footer :: user}"></div>
</body>
</html>